/*! gridster.js - v0.5.6 - 2014-09-25
* http://gridster.net/
* Copyright (c) 2014 ducksboard; Licensed MIT */
;(function(a,b){if(typeof define==="function"&&define.amd){define("gridster-coords",["jquery"],b)}else{a.GridsterCoords=b(a.$||a.jQuery)}}(this,function(c){function a(d){if(d[0]&&c.isPlainObject(d[0])){this.data=d[0]}else{this.el=d}this.isCoords=true;this.coords={};this.init();return this}var b=a.prototype;b.init=function(){this.set();this.original_coords=this.get()};b.set=function(i,e){var f=this.el;if(f&&!i){this.data=f.offset();this.data.width=f.width();this.data.height=f.height()}if(f&&i&&!e){var h=f.offset();this.data.top=h.top;this.data.left=h.left}var g=this.data;typeof g.left==="undefined"&&(g.left=g.x1);typeof g.top==="undefined"&&(g.top=g.y1);this.coords.x1=g.left;this.coords.y1=g.top;this.coords.x2=g.left+g.width;this.coords.y2=g.top+g.height;this.coords.cx=g.left+(g.width/2);this.coords.cy=g.top+(g.height/2);this.coords.width=g.width;this.coords.height=g.height;this.coords.el=f||false;return this};b.update=function(e){if(!e&&!this.el){return this}if(e){var d=c.extend({},this.data,e);this.data=d;return this.set(true,true)}this.set(true);return this};b.get=function(){return this.coords};b.destroy=function(){this.el.removeData("coords");delete this.el};c.fn.coords=function(){if(this.data("coords")){return this.data("coords")}var d=new a(this,arguments[0]);this.data("coords",d);return d};return a}));(function(a,b){if(typeof define==="function"&&define.amd){define("gridster-collision",["jquery","gridster-coords"],b)}else{a.GridsterCollision=b(a.$||a.jQuery,a.GridsterCoords)}}(this,function(c,a){var d={colliders_context:document.body,overlapping_region:"C"};function e(g,h,f){this.options=c.extend(d,f);this.$element=g;this.last_colliders=[];this.last_colliders_coords=[];this.set_colliders(h);this.init()}e.defaults=d;var b=e.prototype;b.init=function(){this.find_collisions()};b.overlaps=function(h,g){var f=false;var i=false;if((g.x1>=h.x1&&g.x1<=h.x2)||(g.x2>=h.x1&&g.x2<=h.x2)||(h.x1>=g.x1&&h.x2<=g.x2)){f=true}if((g.y1>=h.y1&&g.y1<=h.y2)||(g.y2>=h.y1&&g.y2<=h.y2)||(h.y1>=g.y1&&h.y2<=g.y2)){i=true}return(f&&i)};b.detect_overlapping_region=function(g,f){var i="";var h="";if(g.y1>f.cy&&g.y1<f.y2){i="N"}if(g.y2>f.y1&&g.y2<f.cy){i="S"}if(g.x1>f.cx&&g.x1<f.x2){h="W"}if(g.x2>f.x1&&g.x2<f.cx){h="E"}return(i+h)||"C"};b.calculate_overlapped_area_coords=function(g,f){var i=Math.max(g.x1,f.x1);var k=Math.max(g.y1,f.y1);var h=Math.min(g.x2,f.x2);var j=Math.min(g.y2,f.y2);return c({left:i,top:k,width:(h-i),height:(j-k)}).coords().get()};b.calculate_overlapped_area=function(f){return(f.width*f.height)};b.manage_colliders_start_stop=function(n,l,o){var m=this.last_colliders_coords;for(var k=0,f=m.length;k<f;k++){if(c.inArray(m[k],n)===-1){l.call(this,m[k])}}for(var g=0,h=n.length;g<h;g++){if(c.inArray(n[g],m)===-1){o.call(this,n[g])}}};b.find_collisions=function(q){var s=this;var j=this.options.overlapping_region;var k=[];var l=[];var n=(this.colliders||this.$colliders);var o=n.length;var h=s.$element.coords().update(q||false).get();while(o--){var f=s.$colliders?c(n[o]):n[o];var u=(f.isCoords)?f:f.coords();var t=u.get();var i=s.overlaps(h,t);if(!i){continue}var p=s.detect_overlapping_region(h,t);if(p===j||j==="all"){var r=s.calculate_overlapped_area_coords(h,t);var g=s.calculate_overlapped_area(r);var m={area:g,area_coords:r,region:p,coords:t,player_coords:h,el:f};if(s.options.on_overlap){s.options.on_overlap.call(this,m)}k.push(u);l.push(m)}}if(s.options.on_overlap_stop||s.options.on_overlap_start){this.manage_colliders_start_stop(k,s.options.on_overlap_start,s.options.on_overlap_stop)}this.last_colliders_coords=k;return l};b.get_closest_colliders=function(f){var g=this.find_collisions(f);g.sort(function(i,h){if(i.region==="C"&&h.region==="C"){if(i.coords.y1<h.coords.y1||i.coords.x1<h.coords.x1){return -1}else{return 1}}if(i.area<h.area){return 1}return 1});return g};b.set_colliders=function(f){if(typeof f==="string"||f instanceof c){this.$colliders=c(f,this.options.colliders_context).not(this.$element)}else{this.colliders=c(f)}};c.fn.collision=function(g,f){return new e(this,g,f)};return e}));(function(a,b){a.delay=function(d,e){var c=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return d.apply(null,c)},e)};a.debounce=function(d,f,c){var e;return function(){var i=this,h=arguments;var g=function(){e=null;if(!c){d.apply(i,h)}};if(c&&!e){d.apply(i,h)}clearTimeout(e);e=setTimeout(g,f)}};a.throttle=function(e,f){var d,h,i,j,g,k;var c=debounce(function(){g=j=false},f);return function(){d=this;h=arguments;var l=function(){i=null;if(g){e.apply(d,h)}c()};if(!i){i=setTimeout(l,f)}if(j){g=true}else{k=e.apply(d,h)}c();j=true;return k}}})(window);(function(a,b){if(typeof define==="function"&&define.amd){define("gridster-draggable",["jquery"],b)}else{a.GridsterDraggable=b(a.$||a.jQuery)}}(this,function(f){var d={items:"li",distance:1,limit:true,offset_left:0,autoscroll:true,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON"],handle:null,container_width:0,move_element:true,helper:false,remove_helper:true};var b=f(window);var j={x:"left",y:"top"};var e=!!("ontouchstart" in window);var g=function(k){return k.charAt(0).toUpperCase()+k.slice(1)};var c=0;var i=function(){return ++c+""};function a(l,k){this.options=f.extend({},d,k);this.$document=f(document);this.$container=f(l);this.$dragitems=f(this.options.items,this.$container);this.is_dragging=false;this.player_min_left=0+this.options.offset_left;this.id=i();this.ns=".gridster-draggable-"+this.id;this.init()}a.defaults=d;var h=a.prototype;h.init=function(){var k=this.$container.css("position");this.calculate_dimensions();this.$container.css("position",k==="static"?"relative":k);this.disabled=false;this.events();f(window).bind(this.nsEvent("resize"),throttle(f.proxy(this.calculate_dimensions,this),200))};h.nsEvent=function(k){return(k||"")+this.ns};h.events=function(){this.pointer_events={start:this.nsEvent("touchstart")+" "+this.nsEvent("mousedown"),move:this.nsEvent("touchmove")+" "+this.nsEvent("mousemove"),end:this.nsEvent("touchend")+" "+this.nsEvent("mouseup")};this.$container.on(this.nsEvent("selectstart"),f.proxy(this.on_select_start,this));this.$container.on(this.pointer_events.start,this.options.items,f.proxy(this.drag_handler,this));this.$document.on(this.pointer_events.end,f.proxy(function(k){this.is_dragging=false;if(this.disabled){return}this.$document.off(this.pointer_events.move);if(this.drag_start){this.on_dragstop(k)}},this))};h.get_actual_pos=function(k){var l=k.position();return l};h.get_mouse_pos=function(k){if(k.originalEvent&&k.originalEvent.touches){var l=k.originalEvent;k=l.touches.length?l.touches[0]:l.changedTouches[0]}return{left:k.clientX,top:k.clientY}};h.get_offset=function(p){p.preventDefault();var k=this.get_mouse_pos(p);var o=Math.round(k.left-this.mouse_init_pos.left);var l=Math.round(k.top-this.mouse_init_pos.top);var n=Math.round(this.el_init_offset.left+o-this.baseX+f(window).scrollLeft()-this.win_offset_x);var m=Math.round(this.el_init_offset.top+l-this.baseY+f(window).scrollTop()-this.win_offset_y);if(this.options.limit){if(n>this.player_max_left){n=this.player_max_left}else{if(n<this.player_min_left){n=this.player_min_left}}}return{position:{left:n,top:m},pointer:{left:k.left,top:k.top,diff_left:o+(f(window).scrollLeft()-this.win_offset_x),diff_top:l+(f(window).scrollTop()-this.win_offset_y)}}};h.get_drag_data=function(k){var l=this.get_offset(k);l.$player=this.$player;l.$helper=this.helper?this.$helper:this.$player;return l};h.set_limits=function(k){k||(k=this.$container.width());this.player_max_left=(k-this.player_width+-this.options.offset_left);this.options.container_width=k;return this};h.scroll_in=function(m,q){var y=j[m];var v=50;var l=30;var o=m==="x";var A=o?this.window_width:this.window_height;var p=o?f(document).width():f(document).height();var x=o?this.$player.width():this.$player.height();var k;var u=b["scroll"+g(y)]();var z=u;var n=z+A;var t=n-v;var r=z+v;var s=z+q.pointer[y];var w=(p-A+x);if(s>=t){k=u+l;if(k<w){b["scroll"+g(y)](k);this["scroll_offset_"+m]+=l}}if(s<=r){k=u-l;if(k>0){b["scroll"+g(y)](k);this["scroll_offset_"+m]-=l}}return this};h.manage_scroll=function(k){this.scroll_in("x",k);this.scroll_in("y",k)};h.calculate_dimensions=function(k){this.window_height=b.height();this.window_width=b.width()};h.drag_handler=function(m){var l=m.target.nodeName;if(this.disabled||m.which!==1&&!e){return}if(this.ignore_drag(m)){return}var k=this;var n=true;this.$player=f(m.currentTarget);this.el_init_pos=this.get_actual_pos(this.$player);this.mouse_init_pos=this.get_mouse_pos(m);this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top;this.$document.on(this.pointer_events.move,function(r){var o=k.get_mouse_pos(r);var q=Math.abs(o.left-k.mouse_init_pos.left);var p=Math.abs(o.top-k.mouse_init_pos.top);if(!(q>k.options.distance||p>k.options.distance)){return false}if(n){n=false;k.on_dragstart.call(k,r);return false}if(k.is_dragging===true){k.on_dragmove.call(k,r)}return false});if(!e){return false}};h.on_dragstart=function(k){k.preventDefault();if(this.is_dragging){return this}this.drag_start=this.is_dragging=true;var l=this.$container.offset();this.baseX=Math.round(l.left);this.baseY=Math.round(l.top);this.initial_container_width=this.options.container_width||this.$container.width();if(this.options.helper==="clone"){this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper");this.helper=true}else{this.helper=false}this.win_offset_y=f(window).scrollTop();this.win_offset_x=f(window).scrollLeft();this.scroll_offset_y=0;this.scroll_offset_x=0;this.el_init_offset=this.$player.offset();this.player_width=this.$player.width();this.player_height=this.$player.height();this.set_limits(this.options.container_width);if(this.options.start){this.options.start.call(this.$player,k,this.get_drag_data(k))}return false};h.on_dragmove=function(l){var k=this.get_drag_data(l);this.options.autoscroll&&this.manage_scroll(k);if(this.options.move_element){(this.helper?this.$helper:this.$player).css({position:"absolute",left:k.position.left,top:k.position.top})}var m=this.last_position||k.position;k.prev_position=m;if(this.options.drag){this.options.drag.call(this.$player,l,k)}this.last_position=k.position;return false};h.on_dragstop=function(l){var k=this.get_drag_data(l);this.drag_start=false;if(this.options.stop){this.options.stop.call(this.$player,l,k)}if(this.helper&&this.options.remove_helper){this.$helper.remove()}return false};h.on_select_start=function(k){if(this.disabled){return}if(this.ignore_drag(k)){return}return false};h.enable=function(){this.disabled=false};h.disable=function(){this.disabled=true};h.destroy=function(){this.disable();this.$container.off(this.ns);this.$document.off(this.ns);f(window).off(this.ns);f.removeData(this.$container,"drag")};h.ignore_drag=function(k){if(this.options.handle){return !f(k.target).is(this.options.handle)}if(f.isFunction(this.options.ignore_dragging)){return this.options.ignore_dragging(k)}return f(k.target).is(this.options.ignore_dragging.join(", "))};f.fn.drag=function(k){return new a(this,k)};return a}));(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","gridster-draggable","gridster-collision"],b)}else{a.Gridster=b(a.$||a.jQuery,a.GridsterDraggable,a.GridsterCollision)}}(this,function(d,a,f){var e={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,max_cols:Infinity,min_rows:15,max_size_x:false,autogrow_cols:false,autogenerate_stylesheet:true,avoid_overlapped_widgets:true,auto_init:true,serialize_params:function(h,g){return{col:g.col,row:g.row,size_x:g.size_x,size_y:g.size_y}},collision:{},draggable:{items:".gs-w",distance:4,ignore_dragging:a.defaults.ignore_dragging.slice(0)},resize:{enabled:false,axes:["both"],handle_append_to:"",handle_class:"gs-resize-handle",max_size:[Infinity,Infinity],min_size:[1,1]}};function c(h,g){this.options=d.extend(true,{},e,g);this.$el=d(h);this.$wrapper=this.$el.parent();this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs-w");this.widgets=[];this.$changed=d([]);this.wrapper_width=this.$wrapper.width();this.min_widget_width=(this.options.widget_margins[0]*2)+this.options.widget_base_dimensions[0];this.min_widget_height=(this.options.widget_margins[1]*2)+this.options.widget_base_dimensions[1];this.generated_stylesheets=[];this.$style_tags=d([]);this.options.auto_init&&this.init()}c.defaults=e;c.generated_stylesheets=[];c.sort_by_row_asc=function(g){g=g.sort(function(i,h){if(!i.row){i=d(i).coords().grid;h=d(h).coords().grid}if(i.row>h.row){return 1}return -1});return g};c.sort_by_row_and_col_asc=function(g){g=g.sort(function(i,h){if(i.row>h.row||i.row===h.row&&i.col>h.col){return 1}return -1});return g};c.sort_by_col_asc=function(g){g=g.sort(function(i,h){if(i.col>h.col){return 1}return -1});return g};c.sort_by_row_desc=function(g){g=g.sort(function(i,h){if(i.row+i.size_y<h.row+h.size_y){return 1}return -1});return g};var b=c.prototype;b.init=function(){this.options.resize.enabled&&this.setup_resize();this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();this.set_dom_grid_width();this.$wrapper.addClass("ready");this.draggable();this.options.resize.enabled&&this.resizable();d(window).bind("resize.gridster",throttle(d.proxy(this.recalculate_faux_grid,this),200))};b.disable=function(){this.$wrapper.find(".player-revert").removeClass("player-revert");this.drag_api.disable();return this};b.enable=function(){this.drag_api.enable();return this};b.disable_resize=function(){this.$el.addClass("gs-resize-disabled");this.resize_api.disable();return this};b.enable_resize=function(){this.$el.removeClass("gs-resize-disabled");this.resize_api.enable();return this};b.add_widget=function(i,o,m,g,n,j,l){var k;o||(o=1);m||(m=1);if(!g&!n){k=this.next_position(o,m)}else{k={col:g,row:n,size_x:o,size_y:m};this.empty_cells(g,n,o,m)}var h=d(i).attr({"data-col":k.col,"data-row":k.row,"data-sizex":o,"data-sizey":m}).addClass("gs-w").appendTo(this.$el).hide();this.$widgets=this.$widgets.add(h);this.register_widget(h);this.add_faux_rows(k.size_y);if(j){this.set_widget_max_size(h,j)}if(l){this.set_widget_min_size(h,l)}this.set_dom_grid_width();this.set_dom_grid_height();this.drag_api.set_limits(this.cols*this.min_widget_width);return h.fadeIn()};b.add_widget_new=function(j,p,n,h,o,k,m,g){var l;p||(p=1);n||(n=1);if(!h&!o){l=this.next_position(p,n)}else{l={col:h,row:o,size_x:p,size_y:n};this.empty_cells(h,o,p,n)}var i=d(j).attr({"data-col":l.col,"data-row":l.row,"data-sizex":p,"data-sizey":n,"data-name":g}).addClass("gs-w").appendTo(this.$el).hide();this.$widgets=this.$widgets.add(i);this.register_widget(i);this.add_faux_rows(l.size_y);if(k){this.set_widget_max_size(i,k)}if(m){this.set_widget_min_size(i,m)}this.set_dom_grid_width();this.set_dom_grid_height();this.drag_api.set_limits(this.cols*this.min_widget_width);return i.fadeIn()};b.set_widget_min_size=function(i,h){i=typeof i==="number"?this.$widgets.eq(i):i;if(!i.length){return this}var g=i.data("coords").grid;g.min_size_x=h[0];g.min_size_y=h[1];return this};b.set_widget_max_size=function(i,h){i=typeof i==="number"?this.$widgets.eq(i):i;if(!i.length){return this}var g=i.data("coords").grid;g.max_size_x=h[0];g.max_size_y=h[1];return this};b.add_resize_handle=function(g){var h=this.options.resize.handle_append_to;d(this.resize_handle_tpl).appendTo(h?d(h,g):g);return this};b.resize_widget=function(g,r,q,p){var m=g.coords().grid;var i=m.col;var k=this.options.max_cols;var n=m.size_y;var h=m.col;var l=h;r||(r=m.size_x);q||(q=m.size_y);if(k!==Infinity){r=Math.min(r,k-i+1)}if(q>n){this.add_faux_rows(Math.max(q-n,0))}var j=(i+r-1);if(j>this.cols){this.add_faux_cols(j-this.cols)}var o={col:l,row:m.row,size_x:r,size_y:q};this.mutate_widget_in_gridmap(g,m,o);this.set_dom_grid_height();this.set_dom_grid_width();if(p){p.call(this,o.size_x,o.size_y)}return g};b.mutate_widget_in_gridmap=function(g,n,i){var s=n.size_x;var q=n.size_y;var t=this.get_cells_occupied(n);var l=this.get_cells_occupied(i);var h=[];d.each(t.cols,function(w,v){if(d.inArray(v,l.cols)===-1){h.push(v)}});var m=[];d.each(l.cols,function(w,v){if(d.inArray(v,t.cols)===-1){m.push(v)}});var k=[];d.each(t.rows,function(v,w){if(d.inArray(w,l.rows)===-1){k.push(w)}});var p=[];d.each(l.rows,function(v,w){if(d.inArray(w,t.rows)===-1){p.push(w)}});this.remove_from_gridmap(n);if(m.length){var j=[i.col,i.row,i.size_x,Math.min(q,i.size_y),g];this.empty_cells.apply(this,j)}if(p.length){var u=[i.col,i.row,i.size_x,i.size_y,g];this.empty_cells.apply(this,u)}n.col=i.col;n.row=i.row;n.size_x=i.size_x;n.size_y=i.size_y;this.add_to_gridmap(i,g);g.removeClass("player-revert");g.data("coords").update({width:(i.size_x*this.options.widget_base_dimensions[0]+((i.size_x-1)*this.options.widget_margins[0])*2),height:(i.size_y*this.options.widget_base_dimensions[1]+((i.size_y-1)*this.options.widget_margins[1])*2)});g.attr({"data-col":i.col,"data-row":i.row,"data-sizex":i.size_x,"data-sizey":i.size_y});if(h.length){var o=[h[0],i.row,h.length,Math.min(q,i.size_y),g];this.remove_empty_cells.apply(this,o)}if(k.length){var r=[i.col,i.row,i.size_x,i.size_y,g];this.remove_empty_cells.apply(this,r)}this.move_widget_up(g);return this};b.empty_cells=function(j,k,i,h,l){var g=this.widgets_below({col:j,row:k-h,size_x:i,size_y:h});g.not(l).each(d.proxy(function(o,m){var n=d(m).coords().grid;if(!(n.row<=(k+h-1))){return}var p=(k+h)-n.row;this.move_widget_down(d(m),p)},this));this.set_dom_grid_height();return this};b.remove_empty_cells=function(k,l,j,i,h){var g=this.widgets_below({col:k,row:l,size_x:j,size_y:i});g.not(h).each(d.proxy(function(m,n){this.move_widget_up(d(n),i)},this));this.set_dom_grid_height();return this};b.next_position=function(o,n){o||(o=1);n||(n=1);var m=this.gridmap;var l=m.length;var k=[];var h;for(var j=1;j<l;j++){h=m[j].length;for(var g=1;g<=h;g++){var i=this.can_move_to({size_x:o,size_y:n},j,g);if(i){k.push({col:j,row:g,size_y:n,size_x:o})}}}if(k.length){return c.sort_by_row_and_col_asc(k)[0]}return false};b.remove_widget=function(k,h,l){var j=k instanceof d?k:d(k);var i=j.coords().grid;if(d.isFunction(h)){l=h;h=false}this.cells_occupied_by_placeholder={};this.$widgets=this.$widgets.not(j);var g=this.widgets_below(j);this.remove_from_gridmap(i);j.fadeOut(d.proxy(function(){j.remove();if(!h){g.each(d.proxy(function(m,n){this.move_widget_up(d(n),i.size_y)},this))}this.set_dom_grid_height();if(l){l.call(this,k)}},this));return this};b.remove_all_widgets=function(g){this.$widgets.each(d.proxy(function(h,j){this.remove_widget(j,true,g)},this));return this};b.serialize=function(g){g||(g=this.$widgets);return g.map(d.proxy(function(h,k){var j=d(k);return this.options.serialize_params(j,j.coords().grid)},this)).get()};b.serialize_changed=function(){return this.serialize(this.$changed)};b.dom_to_coords=function(g){return{col:parseInt(g.attr("data-col"),10),row:parseInt(g.attr("data-row"),10),size_x:parseInt(g.attr("data-sizex"),10)||1,size_y:parseInt(g.attr("data-sizey"),10)||1,max_size_x:parseInt(g.attr("data-max-sizex"),10)||false,max_size_y:parseInt(g.attr("data-max-sizey"),10)||false,min_size_x:parseInt(g.attr("data-min-sizex"),10)||false,min_size_y:parseInt(g.attr("data-min-sizey"),10)||false,el:g}};b.register_widget=function(i){var j=i instanceof jQuery;var h=j?this.dom_to_coords(i):i;var g=false;j||(i=h.el);var k=this.can_go_widget_up(h);if(k){h.row=k;i.attr("data-row",k);this.$el.trigger("gridster:positionchanged",[h]);g=true}if(this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:h.size_x,size_y:h.size_y},h.col,h.row)){d.extend(h,this.next_position(h.size_x,h.size_y));i.attr({"data-col":h.col,"data-row":h.row,"data-sizex":h.size_x,"data-sizey":h.size_y});g=true}i.data("coords",i.coords());i.data("coords").grid=h;this.add_to_gridmap(h,i);this.options.resize.enabled&&this.add_resize_handle(i);return g};b.update_widget_position=function(g,h){this.for_each_cell_occupied(g,function(i,j){if(!this.gridmap[i]){return this}this.gridmap[i][j]=h});return this};b.remove_from_gridmap=function(g){return this.update_widget_position(g,false)};b.add_to_gridmap=function(h,i){this.update_widget_position(h,i||h.el);if(h.el){var g=this.widgets_below(h.el);g.each(d.proxy(function(j,k){this.move_widget_up(d(k))},this))}};b.draggable=function(){var g=this;var h=d.extend(true,{},this.options.draggable,{offset_left:this.options.widget_margins[0],offset_top:this.options.widget_margins[1],container_width:this.cols*this.min_widget_width,limit:true,start:function(i,j){g.$widgets.filter(".player-revert").removeClass("player-revert");g.$player=d(this);g.$helper=d(j.$helper);g.helper=!g.$helper.is(g.$player);g.on_start_drag.call(g,i,j);g.$el.trigger("gridster:dragstart")},stop:function(i,j){g.on_stop_drag.call(g,i,j);g.$el.trigger("gridster:dragstop")},drag:throttle(function(i,j){g.on_drag.call(g,i,j);g.$el.trigger("gridster:drag")},60)});this.drag_api=this.$el.drag(h);return this};b.resizable=function(){this.resize_api=this.$el.drag({items:"."+this.options.resize.handle_class,offset_left:this.options.widget_margins[0],container_width:this.container_width,move_element:false,resize:true,limit:this.options.autogrow_cols?false:true,start:d.proxy(this.on_start_resize,this),stop:d.proxy(function(g,h){delay(d.proxy(function(){this.on_stop_resize(g,h)},this),120)},this),drag:throttle(d.proxy(this.on_resize,this),60)});return this};b.setup_resize=function(){this.resize_handle_class=this.options.resize.handle_class;var h=this.options.resize.axes;var g='<span class="'+this.resize_handle_class+" "+this.resize_handle_class+'-{type}" />';this.resize_handle_tpl=d.map(h,function(i){return g.replace("{type}",i)}).join("");if(d.isArray(this.options.draggable.ignore_dragging)){this.options.draggable.ignore_dragging.push("."+this.resize_handle_class)}return this};b.on_start_drag=function(i,k){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging");this.highest_col=this.get_highest_occupied_cell().col;this.$player.addClass("player");this.player_grid_data=this.$player.coords().grid;this.placeholder_grid_data=d.extend({},this.player_grid_data);this.set_dom_grid_height(this.$el.height()+(this.player_grid_data.size_y*this.min_widget_height));this.set_dom_grid_width(this.cols);var l=this.player_grid_data.size_x;var g=this.cols-this.highest_col;if(this.options.autogrow_cols&&g<=l){this.add_faux_cols(Math.min(l-g,1))}var h=this.faux_grid;var j=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.last_cols=[];this.last_rows=[];this.collision_api=this.$helper.collision(h,this.options.collision);this.$preview_holder=d("<"+this.$player.get(0).tagName+" />",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:j.width,height:j.height}}).appendTo(this.$el);if(this.options.draggable.start){this.options.draggable.start.call(this,i,k)}};b.on_drag=function(i,j){if(this.$player===null){return false}var h={left:j.position.left+this.baseX,top:j.position.top+this.baseY};if(this.options.autogrow_cols){var g=this.placeholder_grid_data.col+this.placeholder_grid_data.size_x-1;if(g>=this.cols-1&&this.options.max_cols>=this.cols+1){this.add_faux_cols(1);this.set_dom_grid_width(this.cols+1);this.drag_api.set_limits(this.container_width)}this.collision_api.set_colliders(this.faux_grid)}this.colliders_data=this.collision_api.get_closest_colliders(h);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);if(this.helper&&this.$player){this.$player.css({left:j.position.left,top:j.position.top})}if(this.options.draggable.drag){this.options.draggable.drag.call(this,i,j)}};b.on_stop_drag=function(g,h){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging");h.position.left=h.position.left+this.baseX;h.position.top=h.position.top+this.baseY;this.colliders_data=this.collision_api.get_closest_colliders(h.position);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""});this.$changed=this.$changed.add(this.$player);this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data);this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row);this.$player.coords().grid.row=this.placeholder_grid_data.row;this.$player.coords().grid.col=this.placeholder_grid_data.col;if(this.options.draggable.stop){this.options.draggable.stop.call(this,g,h)}this.$preview_holder.remove();this.$player=null;this.$helper=null;this.placeholder_grid_data={};this.player_grid_data={};this.cells_occupied_by_placeholder={};this.cells_occupied_by_player={};this.set_dom_grid_height();this.set_dom_grid_width();if(this.options.autogrow_cols){this.drag_api.set_limits(this.cols*this.min_widget_width)}};b.on_start_resize=function(g,h){this.$resized_widget=h.$player.closest(".gs-w");this.resize_coords=this.$resized_widget.coords();this.resize_wgd=this.resize_coords.grid;this.resize_initial_width=this.resize_coords.coords.width;this.resize_initial_height=this.resize_coords.coords.height;this.resize_initial_sizex=this.resize_coords.grid.size_x;this.resize_initial_sizey=this.resize_coords.grid.size_y;this.resize_initial_col=this.resize_coords.grid.col;this.resize_last_sizex=this.resize_initial_sizex;this.resize_last_sizey=this.resize_initial_sizey;this.resize_max_size_x=Math.min(this.resize_wgd.max_size_x||this.options.resize.max_size[0],this.options.max_cols-this.resize_initial_col+1);this.resize_max_size_y=this.resize_wgd.max_size_y||this.options.resize.max_size[1];this.resize_min_size_x=(this.resize_wgd.min_size_x||this.options.resize.min_size[0]||1);this.resize_min_size_y=(this.resize_wgd.min_size_y||this.options.resize.min_size[1]||1);this.resize_initial_last_col=this.get_highest_occupied_cell().col;this.set_dom_grid_width(this.cols);this.resize_dir={right:h.$player.is("."+this.resize_handle_class+"-x"),bottom:h.$player.is("."+this.resize_handle_class+"-y")};this.$resized_widget.css({"min-width":this.options.widget_base_dimensions[0],"min-height":this.options.widget_base_dimensions[1]});var i=this.$resized_widget.get(0).tagName;this.$resize_preview_holder=d("<"+i+" />",{"class":"preview-holder resize-preview-holder","data-row":this.$resized_widget.attr("data-row"),"data-col":this.$resized_widget.attr("data-col"),css:{width:this.resize_initial_width,height:this.resize_initial_height}}).appendTo(this.$el);this.$resized_widget.addClass("resizing");if(this.options.resize.start){this.options.resize.start.call(this,g,h,this.$resized_widget)}this.$el.trigger("gridster:resizestart")};b.on_stop_resize=function(g,h){this.$resized_widget.removeClass("resizing").css({width:"",height:""});delay(d.proxy(function(){this.$resize_preview_holder.remove().css({"min-width":"","min-height":""});if(this.options.resize.stop){this.options.resize.stop.call(this,g,h,this.$resized_widget)}this.$el.trigger("gridster:resizestop")},this),300);this.set_dom_grid_width();if(this.options.autogrow_cols){this.drag_api.set_limits(this.cols*this.min_widget_width)}};b.on_resize=function(u,p){var A=(p.pointer.diff_left);var z=(p.pointer.diff_top);var i=this.options.widget_base_dimensions[0];var g=this.options.widget_base_dimensions[1];var C=this.options.widget_margins[0];var B=this.options.widget_margins[1];var w=this.resize_max_size_x;var k=this.resize_min_size_x;var v=this.resize_max_size_y;var h=this.resize_min_size_y;var m=this.options.autogrow_cols;var r;var n=Infinity;var q=Infinity;var l=Math.ceil((A/(i+C*2))-0.2);var j=Math.ceil((z/(g+B*2))-0.2);var t=Math.max(1,this.resize_initial_sizex+l);var s=Math.max(1,this.resize_initial_sizey+j);var D=(this.container_width/this.min_widget_width)-this.resize_initial_col+1;var x=((D*this.min_widget_width)-C*2);t=Math.max(Math.min(t,w),k);t=Math.min(D,t);r=(w*i)+((t-1)*C*2);n=Math.min(r,x);min_width=(k*i)+((t-1)*C*2);s=Math.max(Math.min(s,v),h);q=(v*g)+((s-1)*B*2);min_height=(h*g)+((s-1)*B*2);if(this.resize_dir.right){s=this.resize_initial_sizey}else{if(this.resize_dir.bottom){t=this.resize_initial_sizex}}if(m){var o=this.resize_initial_col+t-1;if(m&&this.resize_initial_last_col<=o){this.set_dom_grid_width(Math.max(o+1,this.cols));if(this.cols<o){this.add_faux_cols(o-this.cols)}}}var y={};!this.resize_dir.bottom&&(y.width=Math.max(Math.min(this.resize_initial_width+A,n),min_width));!this.resize_dir.right&&(y.height=Math.max(Math.min(this.resize_initial_height+z,q),min_height));this.$resized_widget.css(y);if(t!==this.resize_last_sizex||s!==this.resize_last_sizey){this.resize_widget(this.$resized_widget,t,s);this.set_dom_grid_width(this.cols);this.$resize_preview_holder.css({width:"",height:""}).attr({"data-row":this.$resized_widget.attr("data-row"),"data-sizex":t,"data-sizey":s})}if(this.options.resize.resize){this.options.resize.resize.call(this,u,p,this.$resized_widget)}this.$el.trigger("gridster:resize");this.resize_last_sizex=t;this.resize_last_sizey=s};b.on_overlapped_column_change=function(h,m){if(!this.colliders_data.length){return this}var k=this.get_targeted_columns(this.colliders_data[0].el.data.col);var l=this.last_cols.length;var j=k.length;var g;for(g=0;g<j;g++){if(d.inArray(k[g],this.last_cols)===-1){(h||d.noop).call(this,k[g])}}for(g=0;g<l;g++){if(d.inArray(this.last_cols[g],k)===-1){(m||d.noop).call(this,this.last_cols[g])}}this.last_cols=k;return this};b.on_overlapped_row_change=function(h,j){if(!this.colliders_data.length){return this}var l=this.get_targeted_rows(this.colliders_data[0].el.data.row);var m=this.last_rows.length;var k=l.length;var g;for(g=0;g<k;g++){if(d.inArray(l[g],this.last_rows)===-1){(h||d.noop).call(this,l[g])}}for(g=0;g<m;g++){if(d.inArray(this.last_rows[g],l)===-1){(j||d.noop).call(this,this.last_rows[g])}}this.last_rows=l};b.set_player=function(j,p,g){var o=this;if(!g){this.empty_cells_player_occupies()}var n=!g?o.colliders_data[0].el.data:{col:j};var l=n.col;var h=p||n.row;this.player_grid_data={col:l,row:h,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x};this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);var m=this.get_widgets_overlapped(this.player_grid_data);var k=this.widgets_constraints(m);this.manage_movements(k.can_go_up,l,h);this.manage_movements(k.can_not_go_up,l,h);if(!m.length){var i=this.can_go_player_up(this.player_grid_data);if(i!==false){h=i}this.set_placeholder(l,h)}return{col:l,row:h}};b.widgets_constraints=function(h){var g=d([]);var j;var i=[];var k=[];h.each(d.proxy(function(n,l){var o=d(l);var m=o.coords().grid;if(this.can_go_widget_up(m)){g=g.add(o);i.push(m)}else{k.push(m)}},this));j=h.not(g);return{can_go_up:c.sort_by_row_asc(i),can_not_go_up:c.sort_by_row_desc(k)}};b.manage_movements=function(h,i,g){d.each(h,d.proxy(function(m,k){var l=k;var o=l.el;var j=this.can_go_widget_up(l);if(j){this.move_widget_to(o,j);this.set_placeholder(i,j+l.size_y)}else{var n=this.can_go_player_up(this.player_grid_data);if(!n){var p=(g+this.player_grid_data.size_y)-l.row;this.move_widget_down(o,p);this.set_placeholder(i,g)}}},this));return this};b.is_player=function(h,i){if(i&&!this.gridmap[h]){return false}var g=i?this.gridmap[h][i]:h;return g&&(g.is(this.$player)||g.is(this.$helper))};b.is_player_in=function(g,h){var i=this.cells_occupied_by_player||{};return d.inArray(g,i.cols)>=0&&d.inArray(h,i.rows)>=0};b.is_placeholder_in=function(g,h){var i=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(g)&&d.inArray(h,i.rows)>=0};b.is_placeholder_in_col=function(g){var h=this.cells_occupied_by_placeholder||[];return d.inArray(g,h.cols)>=0};b.is_empty=function(g,h){if(typeof this.gridmap[g]!=="undefined"){if(typeof this.gridmap[g][h]!=="undefined"&&this.gridmap[g][h]===false){return true}return false}return true};b.is_occupied=function(g,h){if(!this.gridmap[g]){return false}if(this.gridmap[g][h]){return true}return false};b.is_widget=function(h,i){var g=this.gridmap[h];if(!g){return false}g=g[i];if(g){return g}return false};b.is_widget_under_player=function(g,h){if(this.is_widget(g,h)){return this.is_player_in(g,h)}return false};b.get_widgets_under_player=function(h){h||(h=this.cells_occupied_by_player||{cols:[],rows:[]});var g=d([]);d.each(h.cols,d.proxy(function(k,j){d.each(h.rows,d.proxy(function(l,m){if(this.is_widget(j,m)){g=g.add(this.gridmap[j][m])}},this))},this));return g};b.set_placeholder=function(j,m){var i=d.extend({},this.placeholder_grid_data);var g=this.widgets_below({col:i.col,row:i.row,size_y:i.size_y,size_x:i.size_x});var h=(j+i.size_x-1);if(h>this.cols){j=j-(h-j)}var n=this.placeholder_grid_data.row<m;var k=this.placeholder_grid_data.col!==j;this.placeholder_grid_data.col=j;this.placeholder_grid_data.row=m;this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.$preview_holder.attr({"data-row":m,"data-col":j});if(n||k){g.each(d.proxy(function(o,p){this.move_widget_up(d(p),this.placeholder_grid_data.col-j+i.size_y)},this))}var l=this.get_widgets_under_player(this.cells_occupied_by_placeholder);if(l.length){l.each(d.proxy(function(o,q){var p=d(q);this.move_widget_down(p,m+i.size_y-p.data("coords").grid.row)},this))}};b.can_go_player_up=function(l){var i=l.row+l.size_y-1;var g=true;var h=[];var k=10000;var j=this.get_widgets_under_player();this.for_each_column_occupied(l,function(o){var m=this.gridmap[o];var n=i+1;h[o]=[];while(--n>0){if(this.is_empty(o,n)||this.is_player(o,n)||this.is_widget(o,n)&&m[n].is(j)){h[o].push(n);k=n<k?n:k}else{break}}if(h[o].length===0){g=false;return true}h[o].sort(function(q,p){return q-p})});if(!g){return false}return this.get_valid_rows(l,h,k)};b.can_go_widget_up=function(k){var i=k.row+k.size_y-1;var g=true;var h=[];var j=10000;this.for_each_column_occupied(k,function(n){var l=this.gridmap[n];h[n]=[];var m=i+1;while(--m>0){if(this.is_widget(n,m)&&!this.is_player_in(n,m)){if(!l[m].is(k.el)){break}}if(!this.is_player(n,m)&&!this.is_placeholder_in(n,m)&&!this.is_player_in(n,m)){h[n].push(m)}if(m<j){j=m}}if(h[n].length===0){g=false;return true}h[n].sort(function(p,o){return p-o})});if(!g){return false}return this.get_valid_rows(k,h,j)};b.get_valid_rows=function(h,p,o){var m=h.row;var k=h.row+h.size_y-1;var n=h.size_y;var g=o-1;var i=[];while(++g<=k){var l=true;d.each(p,function(q,r){if(d.isArray(r)&&d.inArray(g,r)===-1){l=false}});if(l===true){i.push(g);if(i.length===n){break}}}var j=false;if(n===1){if(i[0]!==m){j=i[0]||false}}else{if(i[0]!==m){j=this.get_consecutive_numbers_index(i,n)}}return j};b.get_consecutive_numbers_index=function(j,k){var h=j.length;var g=[];var n=true;var m=-1;for(var l=0;l<h;l++){if(n||j[l]===m+1){g.push(l);if(g.length===k){break}n=false}else{g=[];n=true}m=j[l]}return g.length>=k?j[g[0]]:false};b.get_widgets_overlapped=function(){var j;var g=d([]);var i=[];var h=this.cells_occupied_by_player.rows.slice(0);h.reverse();d.each(this.cells_occupied_by_player.cols,d.proxy(function(l,k){d.each(h,d.proxy(function(m,o){if(!this.gridmap[k]){return true}var n=this.gridmap[k][o];if(this.is_occupied(k,o)&&!this.is_player(n)&&d.inArray(n,i)===-1){g=g.add(n);i.push(n)}},this))},this));return g};b.on_start_overlapping_column=function(g){this.set_player(g,false)};b.on_start_overlapping_row=function(g){this.set_player(false,g)};b.on_stop_overlapping_column=function(h){this.set_player(h,false);var g=this;this.for_each_widget_below(h,this.cells_occupied_by_player.rows[0],function(j,i){g.move_widget_up(this,g.player_grid_data.size_y)})};b.on_stop_overlapping_row=function(j){this.set_player(false,j);var h=this;var i=this.cells_occupied_by_player.cols;for(var k=0,g=i.length;k<g;k++){this.for_each_widget_below(i[k],j,function(m,l){h.move_widget_up(this,h.player_grid_data.size_y)})}};b.move_widget_to=function(m,l){var g=this;var i=m.coords().grid;var k=l-i.row;var j=this.widgets_below(m);var h=this.can_move_to(i,i.col,l,m);if(h===false){return false}this.remove_from_gridmap(i);i.row=l;this.add_to_gridmap(i);m.attr("data-row",l);this.$changed=this.$changed.add(m);j.each(function(o,q){var p=d(q);var n=p.coords().grid;var r=g.can_go_widget_up(n);if(r&&r!==n.row){g.move_widget_to(p,r)}});return this};b.move_widget_up=function(l,k){var j=l.coords().grid;var g=j.row;var h=[];var i=true;k||(k=1);if(!this.can_go_up(l)){return false}this.for_each_column_occupied(j,function(m){if(d.inArray(l,h)===-1){var n=l.coords().grid;var o=g-k;o=this.can_go_up_to_row(n,m,o);if(!o){return true}var p=this.widgets_below(l);this.remove_from_gridmap(n);n.row=o;this.add_to_gridmap(n);l.attr("data-row",n.row);this.$changed=this.$changed.add(l);h.push(l);p.each(d.proxy(function(q,r){this.move_widget_up(d(r),k)},this))}})};b.move_widget_down=function(g,k){var h,n,m,l;if(k<=0){return false}h=g.coords().grid;n=h.row;m=[];l=k;if(!g){return false}if(d.inArray(g,m)===-1){var j=g.coords().grid;var o=n+k;var i=this.widgets_below(g);this.remove_from_gridmap(j);i.each(d.proxy(function(q,t){var s=d(t);var r=s.coords().grid;var p=this.displacement_diff(r,j,l);if(p>0){this.move_widget_down(s,p)}},this));j.row=o;this.update_widget_position(j,g);g.attr("data-row",j.row);this.$changed=this.$changed.add(g);m.push(g)}};b.can_go_up_to_row=function(i,h,p){var n=this.gridmap;var q=true;var k=[];var m=i.row;var g;this.for_each_column_occupied(i,function(s){var r=n[s];k[s]=[];g=m;while(g--){if(this.is_empty(s,g)&&!this.is_placeholder_in(s,g)){k[s].push(g)}else{break}}if(!k[s].length){q=false;return true}});if(!q){return false}g=p;for(g=1;g<m;g++){var l=true;for(var o=0,j=k.length;o<j;o++){if(k[o]&&d.inArray(g,k[o])===-1){l=false}}if(l===true){q=g;break}}return q};b.displacement_diff=function(j,k,m){var h=j.row;var l=[];var i=k.row+k.size_y;this.for_each_column_occupied(j,function(n){var p=0;for(var o=i;o<h;o++){if(this.is_empty(n,o)){p=p+1}}l.push(p)});var g=Math.max.apply(Math,l);m=(m-g);return m>0?m:0};b.widgets_below=function(i){var k=d.isPlainObject(i)?i:i.coords().grid;var h=this;var l=this.gridmap;var j=k.row+k.size_y-1;var g=d([]);this.for_each_column_occupied(k,function(m){h.for_each_widget_below(m,j,function(o,n){if(!h.is_player(this)&&d.inArray(this,g)===-1){g=g.add(this);return true}})});return c.sort_by_row_asc(g)};b.set_cells_player_occupies=function(g,h){this.remove_from_gridmap(this.placeholder_grid_data);this.placeholder_grid_data.col=g;this.placeholder_grid_data.row=h;this.add_to_gridmap(this.placeholder_grid_data,this.$player);return this};b.empty_cells_player_occupies=function(){this.remove_from_gridmap(this.placeholder_grid_data);return this};b.can_go_up=function(i){var l=i.coords().grid;var j=l.row;var k=j-1;var m=this.gridmap;var h=[];var g=true;if(j===1){return false}this.for_each_column_occupied(l,function(n){var o=this.is_widget(n,k);if(this.is_occupied(n,k)||this.is_player(n,k)||this.is_placeholder_in(n,k)||this.is_player_in(n,k)){g=false;return true}});return g};b.can_move_to=function(h,g,n,l){var m=this.gridmap;var i=h.el;var j={size_y:h.size_y,size_x:h.size_x,col:g,row:n};var o=true;var k=g+h.size_x-1;if(k>this.cols){return false}if(l&&l<n+h.size_y-1){return false}this.for_each_cell_occupied(j,function(r,q){var p=this.is_widget(r,q);if(p&&(!h.el||p.is(i))){o=false}});return o};b.get_targeted_columns=function(j){var g=(j||this.player_grid_data.col)+(this.player_grid_data.size_x-1);var i=[];for(var h=j;h<=g;h++){i.push(h)}return i};b.get_targeted_rows=function(h){var g=(h||this.player_grid_data.row)+(this.player_grid_data.size_y-1);var i=[];for(var j=h;j<=g;j++){i.push(j)}return i};b.get_cells_occupied=function(k){var h={cols:[],rows:[]};var j;if(arguments[1] instanceof d){k=arguments[1].coords().grid}for(j=0;j<k.size_x;j++){var g=k.col+j;h.cols.push(g)}for(j=0;j<k.size_y;j++){var l=k.row+j;h.rows.push(l)}return h};b.for_each_cell_occupied=function(g,h){this.for_each_column_occupied(g,function(i){this.for_each_row_occupied(g,function(j){h.call(this,i,j)})});return this};b.for_each_column_occupied=function(j,k){for(var h=0;h<j.size_x;h++){var g=j.col+h;k.call(this,g,j)}};b.for_each_row_occupied=function(h,k){for(var g=0;g<h.size_y;g++){var j=h.row+g;k.call(this,j,h)}};b._traversing_widgets=function(m,p,i,s,q){var r=this.gridmap;if(!r[i]){return}var l,o;var k=m+"/"+p;if(arguments[2] instanceof d){var g=arguments[2].coords().grid;i=g.col;s=g.row;q=arguments[3]}var h=[];var n=s;var j={"for_each/above":function(){while(n--){if(n>0&&this.is_widget(i,n)&&d.inArray(r[i][n],h)===-1){l=q.call(r[i][n],i,n);h.push(r[i][n]);if(l){break}}}},"for_each/below":function(){for(n=s+1,o=r[i].length;n<o;n++){if(this.is_widget(i,n)&&d.inArray(r[i][n],h)===-1){l=q.call(r[i][n],i,n);h.push(r[i][n]);if(l){break}}}}};if(j[k]){j[k].call(this)}};b.for_each_widget_above=function(g,h,i){this._traversing_widgets("for_each","above",g,h,i);return this};b.for_each_widget_below=function(g,h,i){this._traversing_widgets("for_each","below",g,h,i);return this};b.get_highest_occupied_cell=function(){var g;var j=this.gridmap;var k=j[1].length;var h=[],i=[];var m=[];for(var l=j.length-1;l>=1;l--){for(g=k-1;g>=1;g--){if(this.is_widget(l,g)){h.push(g);i.push(l);break}}}return{col:Math.max.apply(Math,i),row:Math.max.apply(Math,h)}};b.get_widgets_from=function(h,j){var i=this.gridmap;var g=d();if(h){g=g.add(this.$widgets.filter(function(){var k=d(this).attr("data-col");return(k===h||k>h)}))}if(j){g=g.add(this.$widgets.filter(function(){var k=d(this).attr("data-row");return(k===j||k>j)}))}return g};b.set_dom_grid_height=function(g){if(typeof g==="undefined"){var h=this.get_highest_occupied_cell().row;g=h*this.min_widget_height}this.container_height=g;this.$el.css("height",this.container_height);return this};b.set_dom_grid_height_new=function(g,i){if(typeof g==="undefined"){var j=this.get_highest_occupied_cell().row;g=j*i}this.container_height=g;this.$el.css("height",this.container_height);return this};b.set_dom_grid_width=function(h){if(typeof h==="undefined"){h=this.get_highest_occupied_cell().col}var g=(this.options.autogrow_cols?this.options.max_cols:this.cols);h=Math.min(g,Math.max(h,this.options.min_cols));this.container_width=h*this.min_widget_width;this.$el.css("width",this.container_width);return this};b.set_dom_grid_width_new=function(i,h){if(typeof i==="undefined"){i=this.get_highest_occupied_cell().col}var g=(this.options.autogrow_cols?this.options.max_cols:this.cols);i=Math.min(g,Math.max(i,this.options.min_cols));this.container_width=i*h;this.$el.css("width",this.container_width);return this};b.generate_stylesheet=function(g){var q="";var n=this.options.max_size_x||this.cols;var l=0;var k=0;var j;var p;g||(g={});g.cols||(g.cols=this.cols);g.rows||(g.rows=this.rows);g.namespace||(g.namespace=this.options.namespace);g.widget_base_dimensions||(g.widget_base_dimensions=this.options.widget_base_dimensions);g.widget_margins||(g.widget_margins=this.options.widget_margins);g.min_widget_width=(g.widget_margins[0]*2)+g.widget_base_dimensions[0];g.min_widget_height=(g.widget_margins[1]*2)+g.widget_base_dimensions[1];var h=d.param(g);if(d.inArray(h,c.generated_stylesheets)>=0){return false}this.generated_stylesheets.push(h);c.generated_stylesheets.push(h);for(j=g.cols;j>=0;j--){q+=(g.namespace+' [data-col="'+(j+1)+'"] { left:'+((j*g.widget_base_dimensions[0])+(j*g.widget_margins[0])+((j+1)*g.widget_margins[0]))+"px; }\n")}for(j=g.rows;j>=0;j--){q+=(g.namespace+' [data-row="'+(j+1)+'"] { top:'+((j*g.widget_base_dimensions[1])+(j*g.widget_margins[1])+((j+1)*g.widget_margins[1]))+"px; }\n")}for(var m=1;m<=g.rows;m++){q+=(g.namespace+' [data-sizey="'+m+'"] { height:'+(m*g.widget_base_dimensions[1]+(m-1)*(g.widget_margins[1]*2))+"px; }\n")}for(var o=1;o<=n;o++){q+=(g.namespace+' [data-sizex="'+o+'"] { width:'+(o*g.widget_base_dimensions[0]+(o-1)*(g.widget_margins[0]*2))+"px; }\n")}this.remove_style_tags();return this.add_style_tag(q)};b.add_style_tag=function(h){var i=document;var g=i.createElement("style");i.getElementsByTagName("head")[0].appendChild(g);g.setAttribute("type","text/css");if(g.styleSheet){g.styleSheet.cssText=h}else{g.appendChild(document.createTextNode(h))}this.$style_tags=this.$style_tags.add(g);return this};b.remove_style_tags=function(){var g=c.generated_stylesheets;var h=this.generated_stylesheets;this.$style_tags.remove();c.generated_stylesheets=d.map(g,function(i){if(d.inArray(i,h)===-1){return i}})};b.generate_faux_grid=function(h,i){this.faux_grid=[];this.gridmap=[];var g;var j;for(g=i;g>0;g--){this.gridmap[g]=[];for(j=h;j>0;j--){this.add_faux_cell(j,g)}}return this};b.add_faux_cell=function(i,g){var h=d({left:this.baseX+((g-1)*this.min_widget_width),top:this.baseY+(i-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:g,row:i,original_col:g,original_row:i}).coords();if(!d.isArray(this.gridmap[g])){this.gridmap[g]=[]}this.gridmap[g][i]=false;this.faux_grid.push(h);return this};b.add_faux_rows=function(j){var h=this.rows;var g=h+(j||1);for(var i=g;i>h;i--){for(var k=this.cols;k>=1;k--){this.add_faux_cell(i,k)}}this.rows=g;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this};b.add_faux_cols=function(j){var h=this.cols;var g=h+(j||1);g=Math.min(g,this.options.max_cols);for(var k=h+1;k<=g;k++){for(var i=this.rows;i>=1;i--){this.add_faux_cell(i,k)}}this.cols=g;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this};b.recalculate_faux_grid=function(){var g=this.$wrapper.width();this.baseX=(d(window).width()-g)/2;this.baseY=this.$wrapper.offset().top;d.each(this.faux_grid,d.proxy(function(h,j){this.faux_grid[h]=j.update({left:this.baseX+(j.data.col-1)*this.min_widget_width,top:this.baseY+(j.data.row-1)*this.min_widget_height})},this));return this};b.get_widgets_from_DOM=function(){var g=this.$widgets.map(d.proxy(function(j,l){var k=d(l);return this.dom_to_coords(k)},this));g=c.sort_by_row_and_col_asc(g);var h=d(g).map(d.proxy(function(k,j){return this.register_widget(j)||null},this));if(h.length){this.$el.trigger("gridster:positionschanged")}return this};b.generate_grid_and_stylesheet=function(){var l=this.$wrapper.width();var i=this.options.max_cols;var k=Math.floor(l/this.min_widget_width)+this.options.extra_cols;var j=this.$widgets.map(function(){return d(this).attr("data-col")}).get();j.length||(j=[0]);var h=Math.max.apply(Math,j);this.cols=Math.max(h,k,this.options.min_cols);if(i!==Infinity&&i>=h&&i<this.cols){this.cols=i}var g=this.options.extra_rows;this.$widgets.each(function(n,m){g+=(+d(m).attr("data-sizey"))});this.rows=Math.max(g,this.options.min_rows);this.baseX=(d(window).width()-l)/2;this.baseY=this.$wrapper.offset().top;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this.generate_faux_grid(this.rows,this.cols)};b.destroy=function(g){this.$el.removeData("gridster");d(window).unbind(".gridster");if(this.drag_api){this.drag_api.destroy()}this.remove_style_tags();g&&this.$el.remove();return this};d.fn.gridster=function(g){return this.each(function(){if(!d(this).data("gridster")){d(this).data("gridster",new c(this,g))}})};return c}));